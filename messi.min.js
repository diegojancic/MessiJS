!function(){"use strict";function t(i,s){var e,o=this;if(o.options=jQuery.extend({},t.prototype.options,s||{}),o.messi=jQuery(o.template),o.setContent(i),null===o.options.title?jQuery(".messi-titlebox",o.messi).remove():(jQuery(".messi-title",o.messi).append(o.options.title),0!==o.options.buttons.length||o.options.autoclose||o.options.closeButton&&(e=jQuery('<span class="messi-closebtn"></span>'),e.bind("click",function(){o.hide()}),jQuery(".messi-titlebox",this.messi).prepend(e)),null!==o.options.titleClass&&jQuery(".messi-titlebox",this.messi).addClass(o.options.titleClass)),null!==o.options.width&&jQuery(".messi-box",o.messi).css("width",o.options.width),o.options.buttons.length>0)for(var n=function(){o.options.callback.call(this.value)},l=0;l<o.options.buttons.length;l++){var a=o.options.buttons[l]["class"]?o.options.buttons[l]["class"]:"",h='<button data-value="'+o.options.buttons[l].val+'" class="btn '+a+'" href="#">'+o.options.buttons[l].label+"</button>";h=jQuery('<div class="btnbox">'+h+"</div>",{}),jQuery(".messi-actions",this.messi).append(h),jQuery(document).delegate(".messi-actions button","click",function(){{var t=null;jQuery(this).data("value")}"function"==typeof o.options.callback&&(t=n),o.hide(t)})}else jQuery(".messi-footbox",this.messi).remove();return 0!==o.options.buttons.length||null!==o.options.title||o.options.autoclose||o.options.closeButton&&(e=jQuery('<span class="messi-closebtn"></span>'),e.bind("click",function(){o.hide()}),jQuery(".messi-content",this.messi).prepend(e)),o.modal=o.options.modal?jQuery('<div class="messi-modal"></div>').css({opacity:o.options.modalOpacity,width:jQuery(document).width(),height:jQuery(document).height(),"z-index":o.options.zIndex+jQuery(".messi").length}).appendTo(document.body):null,o.options.show&&o.show(),jQuery(window).bind("resize scroll",function(){o.resize()}),null!==o.options.autoclose&&setTimeout(function(){var t=jQuery.data(this,"value"),i=null!==o.options.callback?function(){o.options.callback(t)}:null;o.hide(i)},o.options.autoclose,this),o}t.prototype={options:{autoclose:null,buttons:[],callback:null,center:!0,closeButton:!0,height:"auto",title:null,titleClass:null,minMargin:15,modal:!1,modalOpacity:.2,padding:"10px",show:!0,unload:!0,viewport:{top:"0px",left:"0px"},width:"500px",zIndex:99999},template:'<div class="messi"><div class="messi-box"><div class="messi-wrapper"><div class="messi-titlebox"><span class="messi-title"></span></div><div class="messi-content"></div><div class="messi-footbox"><div class="messi-actions"></div></div></div></div></div>',content:"<div></div>",visible:!1,setContent:function(t){jQuery(".messi-content",this.messi).css({padding:this.options.padding,height:this.options.height}).empty().append(t)},viewport:function(){return{top:(jQuery(window).height()-this.messi.height())/2+jQuery(window).scrollTop()+"px",left:(jQuery(window).width()-this.messi.width())/2+jQuery(window).scrollLeft()+"px"}},show:function(){this.visible||(0===this.messi.parent().length&&(this.modal&&this.modal.appendTo(document.body),this.messi.appendTo(document.body)),this.modal&&this.modal.show(),this.options.center?this.options.viewport=this.viewport(jQuery(".messi-box",this.messi)):this.nudge(),this.messi.css({top:this.options.viewport.top,left:this.options.viewport.left,"z-index":this.options.zIndex+jQuery(".messi").length}).show().animate({opacity:1},300),this.visible=!0)},hide:function(t){if(this.visible){var i=this;return"function"==typeof t&&t.call(this)===!1?this:(this.messi.animate({opacity:0},300,function(){i.modal&&i.modal.css({display:"none"}),i.messi.css({display:"none"}),i.visible=!1,i.options.unload&&i.unload()}),this)}},resize:function(){this.options.modal&&jQuery(".messi-modal").css({width:jQuery(document).width(),height:jQuery(document).height()}),this.options.center&&(this.options.viewport=this.viewport(jQuery(".messi-box",this.messi)),this.messi.css({top:this.options.viewport.top,left:this.options.viewport.left}))},toggle:function(){return this[this.visible?"hide":"show"](),this},unload:function(){this.visible&&this.hide(),jQuery(window).unbind("resize scroll"),this.modal&&this.modal.remove(),this.messi.remove()},nudge:function(){var t=jQuery(window),i=this.options.viewport.left.replace("px",""),s=this.options.viewport.top.replace("px","");if(this.isNumber(i)&&this.isNumber(s)){i=parseInt(i,10),s=parseInt(s,10);var e=jQuery(document).scrollLeft()+t.width()-this.messi.width()-this.options.minMargin;i>e&&(i-=this.messi.width()+2*this.options.minMargin),i=this.max(i,0),s+this.messi.height()>t.height()+jQuery(document).scrollTop()&&(s-=this.messi.height()+this.options.minMargin),this.options.viewport.left=i.toString()+"px",this.options.viewport.top=s.toString()+"px"}},max:function(t,i){return t>i?t:i},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},jQuery.extend(t,{alert:function(i,s,e){var o=[{id:"ok",label:"OK",val:"OK"}];return e=jQuery.extend({closeButton:!1,buttons:o,callback:function(){}},e||{},{show:!0,unload:!0,callback:s}),new t(i,e)},ask:function(i,s,e){var o=[{id:"yes",label:"Yes",val:"Y","class":"btn-success"},{id:"no",label:"No",val:"N","class":"btn-danger"}];return e=jQuery.extend({closeButton:!1,modal:!0,buttons:o,callback:function(){}},e||{},{show:!0,unload:!0,callback:s}),new t(i,e)},img:function(i,s){var e=new Image;jQuery(e).load(function(){var i={width:jQuery(window).width()-50,height:jQuery(window).height()-50},o=this.width>i.width||this.height>i.height?Math.min(i.width/this.width,i.height/this.height):1;jQuery(e).css({width:this.width*o,height:this.height*o}),s=jQuery.extend(s||{},{show:!0,unload:!0,closeButton:!0,width:this.width*o,height:this.height*o,padding:0}),new t(e,s)}).error(function(){"object"==typeof window.console&&console.log("Error loading "+i)}).attr("src",i)},load:function(i,s){s=jQuery.extend(s||{},{show:!0,unload:!0,params:{}});var e={url:i,data:s.params,dataType:"html",cache:!1,error:function(t){"object"==typeof window.console&&console.log(t.responseText)},success:function(i){new t(i,s)}};jQuery.ajax(e)}}),window.Messi=t,jQuery.Messi=t}();